# TapMove Architecture Diagrams

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   TapGrid    â”‚â”€â”€â”€â–¶â”‚ useTapMarket â”‚â”€â”€â”€â–¶â”‚ tapMarket   â”‚  â”‚
â”‚  â”‚  Component   â”‚    â”‚     Hook     â”‚    â”‚   Client    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                   â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                              Aptos SDK
                                                    â”‚
                                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Movement Testnet                         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         tap_market::tap_market Module                â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ place_bet  â”‚  â”‚init_market â”‚  â”‚ settle_bet   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  Market<CoinType> { ... }                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ Pyth Network  â”‚
                            â”‚ Price Feeds   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Hierarchy

```
App
 â””â”€ AppWithPrivy (PrivyProvider wrapper)
     â””â”€ AppContent
         â”œâ”€ Header (wallet controls)
         â”‚   â”œâ”€ Connect button
         â”‚   â””â”€ Account display
         â”‚
         â””â”€ TapGrid
             â”œâ”€ Controls (stake input, status)
             â”œâ”€ Legend
             â””â”€ Grid
                 â”œâ”€ Column headers (time)
                 â”œâ”€ Row headers (price)
                 â””â”€ Cells (bettable/locked)
```

## Data Flow: Placing a Bet

```
User clicks cell (row 7, col 5)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TapGrid Component      â”‚
â”‚ â€¢ handleCellClick()    â”‚
â”‚ â€¢ Validate not locked  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useTapMarket Hook      â”‚
â”‚ â€¢ placeBet()           â”‚
â”‚ â€¢ Convert coordinates: â”‚
â”‚   - row 7 â†’ bucket 7   â”‚
â”‚   - col 5 â†’ timestamp  â”‚
â”‚ â€¢ Validate params      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tapMarketClient        â”‚
â”‚ â€¢ checkBalance()       â”‚
â”‚ â€¢ Build transaction:   â”‚
â”‚   - function path      â”‚
â”‚   - type args          â”‚
â”‚   - function args      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aptos SDK              â”‚
â”‚ â€¢ Sign transaction     â”‚
â”‚ â€¢ Submit to chain      â”‚
â”‚ â€¢ Wait for confirmationâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Movement Blockchain    â”‚
â”‚ â€¢ Execute place_bet    â”‚
â”‚ â€¢ Validate constraints â”‚
â”‚ â€¢ Store bet record     â”‚
â”‚ â€¢ Transfer coins       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Success! (txHash)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ onBetPlaced callback   â”‚
â”‚ â€¢ Show notification    â”‚
â”‚ â€¢ Update UI            â”‚
â”‚ â€¢ Track analytics      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Grid Coordinate System

```
Price Buckets (Y-axis)
   â–²
14 â”‚ â•”â•â•â•â•¦â•â•â•â•¦â•â•â•â•¦â•â•â•â•—  Highest price (+7 from mid)
13 â”‚ â•‘   â•‘   â•‘   â•‘   â•‘
12 â”‚ â•‘   â•‘   â•‘   â•‘   â•‘
   â”‚ â•‘   â•‘   â•‘   â•‘   â•‘
 8 â”‚ â•‘   â•‘   â•‘   â•‘   â•‘
 7 â”‚ â•‘MIDâ•‘2.1xâ•‘2.3xâ•‘2.5xâ•‘  Mid price (anchor)
 6 â”‚ â•‘   â•‘   â•‘   â•‘   â•‘
   â”‚ â•‘   â•‘   â•‘   â•‘   â•‘
 1 â”‚ â•‘   â•‘   â•‘   â•‘   â•‘
 0 â”‚ â•šâ•â•â•â•©â•â•â•â•©â•â•â•â•©â•â•â•â•  Lowest price (-7 from mid)
   â””â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     ğŸ”’ T+0 T+1 T+2 T+3  Time Buckets (X-axis)
   Locked  â”‚   â”‚   â”‚
          Now +10s +20s +30s
```

## Transaction Payload Structure

```
{
  function: "0xADDR::tap_market::place_bet",
  typeArguments: [
    "0x1::aptos_coin::AptosCoin"  // <CoinType>
  ],
  functionArguments: [
    "0xMARKET_ADMIN_ADDR",  // market_admin: address
    "1000000",              // stake_amount: u64
    7,                      // price_bucket: u8
    1702803000              // expiry_timestamp_secs: u64
  ]
}
```

## State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Component State            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  TapGrid                            â”‚
â”‚  â”œâ”€ selectedCell: {row, col}        â”‚
â”‚  â”œâ”€ stakeAmount: string             â”‚
â”‚  â””â”€ currentTime: number             â”‚
â”‚                                     â”‚
â”‚  useTapMarket Hook                  â”‚
â”‚  â”œâ”€ isPlacing: boolean              â”‚
â”‚  â””â”€ error: string | null            â”‚
â”‚                                     â”‚
â”‚  useGridState Hook                  â”‚
â”‚  â”œâ”€ currentBucket: number           â”‚
â”‚  â””â”€ earliestBettableBucket: number  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Multiplier Calculation

```
Input: rowIndex = 10, columnIndex = 5
       midPriceBucket = 7
       lockedColumnsAhead = 1

Step 1: Calculate price distance
  priceDistance = |10 - 7| = 3

Step 2: Calculate time bonus distance
  minTimeDistance = 1 + 1 = 2
  actualTimeDistance = 2 + 5 = 7
  timeBonusDistance = 7 - 2 = 5

Step 3: Compute multiplier in basis points
  BASE_MULT_BPS = 10500        (1.05x)
  DISTANCE_STEP_BPS = 600      (+0.06x per row)
  TIME_STEP_BPS = 800          (+0.08x per column)
  
  multBps = 10500
          + (3 Ã— 600)           = 1800
          + (5 Ã— 800)           = 4000
          = 16300 bps

Step 4: Convert to decimal
  multiplier = 16300 / 10000 = 1.63x
```

## Time Bucket Calculation

```
Given:
  now = 1702800000 seconds (Unix timestamp)
  timeBucketSeconds = 10
  lockedColumnsAhead = 1
  columnIndex = 5

Step 1: Current bucket
  currentBucket = floor(1702800000 / 10)
                = 170280000

Step 2: Earliest bettable bucket
  earliestBucket = 170280000 + 1 + 1
                 = 170280002

Step 3: Target bucket for column
  targetBucket = 170280002 + 5
               = 170280007

Step 4: Expiry timestamp
  expiryTimestamp = 170280007 Ã— 10
                  = 1702800070 seconds
```

## Error Flow

```
Transaction Error
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Catch in client â”‚
â”‚ parseError()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Match error codeâ”‚
â”‚ E_COLUMN_LOCKED â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User-friendly   â”‚
â”‚ "Column locked" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hook sets error â”‚
â”‚ state           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI displays     â”‚
â”‚ error message   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Privy Wallet Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PrivyProvider                â”‚
â”‚  (wraps entire app)                  â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      usePrivy Hook             â”‚ â”‚
â”‚  â”‚  â€¢ login()                     â”‚ â”‚
â”‚  â”‚  â€¢ logout()                    â”‚ â”‚
â”‚  â”‚  â€¢ authenticated               â”‚ â”‚
â”‚  â”‚  â€¢ user                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      useWallets Hook           â”‚ â”‚
â”‚  â”‚  â€¢ wallets[]                   â”‚ â”‚
â”‚  â”‚  â€¢ find Aptos wallet           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Aptos Wallet â”‚
         â”‚  â€¢ address   â”‚
         â”‚  â€¢ sign()    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
         Used by TapGrid
```

## File Dependencies

```
config.ts
  â†“
tapMarketClient.ts â”€â”€â”€â”€â”€â”
  â†“                     â”‚
useTapMarket.ts         â”‚
  â†“                     â”‚
TapGrid.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
PrivyIntegration.tsx
  â†“
App.tsx
```

## Security Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          User's Browser             â”‚
â”‚                                     â”‚
â”‚  Private Key:                       â”‚
â”‚  â€¢ Stored in Privy's secure enclaveâ”‚
â”‚  â€¢ Never exposed to app code       â”‚
â”‚  â€¢ Used only for signing           â”‚
â”‚                                     â”‚
â”‚  Transaction Signing:               â”‚
â”‚  â€¢ Privy prompts user              â”‚
â”‚  â€¢ User approves                   â”‚
â”‚  â€¢ Privy signs with private key    â”‚
â”‚  â€¢ Signed tx sent to chain         â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Movement Blockchain          â”‚
â”‚                                     â”‚
â”‚  Transaction Validation:            â”‚
â”‚  â€¢ Verify signature                â”‚
â”‚  â€¢ Check sender has coins          â”‚
â”‚  â€¢ Execute Move function            â”‚
â”‚  â€¢ Update state                    â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

These diagrams illustrate the complete architecture and data flow of the TapMove frontend integration.
